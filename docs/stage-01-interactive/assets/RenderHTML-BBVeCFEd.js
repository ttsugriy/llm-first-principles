import{s as p}from"./chunk-DZLz74EQ.js";import{c as S,d as j}from"./jotai-BTnrNcC1.js";import{t as _}from"./react-BcIddLXZ.js";import{br as u,yr as w}from"./cells-DV6dfoCq.js";import{t as y}from"./compiler-runtime-Cr9loedd.js";import{t as N}from"./jsx-runtime-mwDPpfh_.js";import{t as R}from"./mode-BK9SOQXS.js";import{t as z}from"./usePress-C2JVmCUi.js";import{t as k}from"./copy-icon-Ckew1l1_.js";import{t as A}from"./purify.es-CmG1k0Cr.js";import{t as C}from"./useRunCells-WnlQjiPG.js";var H=p(y(),1),m=p(_(),1),s=p(N(),1);const M=e=>{let t=(0,H.c)(16),r,a,i;t[0]===e?(r=t[1],a=t[2],i=t[3]):({href:a,children:r,...i}=e,t[0]=e,t[1]=r,t[2]=a,t[3]=i);let o=(0,m.useRef)(null),l;t[4]===a?l=t[5]:(l=()=>{let h=new URL(globalThis.location.href);h.hash=a,globalThis.history.pushState({},"",h.toString());let x=a.slice(1),v=document.getElementById(x);v&&v.scrollIntoView({behavior:"smooth",block:"start"})},t[4]=a,t[5]=l);let n=l,c;t[6]===n?c=t[7]:(c={onPress:()=>{n()}},t[6]=n,t[7]=c);let{pressProps:g}=z(c),f;t[8]===n?f=t[9]:(f=h=>{h.preventDefault(),n()},t[8]=n,t[9]=f);let E=f,d;return t[10]!==r||t[11]!==E||t[12]!==a||t[13]!==g||t[14]!==i?(d=(0,s.jsx)("a",{ref:o,href:a,...g,onClick:E,...i,children:r}),t[10]=r,t[11]=E,t[12]=a,t[13]=g,t[14]=i,t[15]=d):d=t[15],d};var T=j(e=>{if(e(C))return!1;let t=!0;try{t=R()==="read"}catch{return!0}return!t});function F(){return S(T)}var b="data-temp-href-target";A.addHook("beforeSanitizeAttributes",e=>{e.tagName==="A"&&(e.hasAttribute("target")||e.setAttribute("target","_self"),e.hasAttribute("target")&&e.setAttribute(b,e.getAttribute("target")||""))}),A.addHook("afterSanitizeAttributes",e=>{e.tagName==="A"&&e.hasAttribute(b)&&(e.setAttribute("target",e.getAttribute(b)||""),e.removeAttribute(b),e.getAttribute("target")==="_blank"&&e.setAttribute("rel","noopener"))});function L(e){return A.sanitize(e,{USE_PROFILES:{html:!0,svg:!0,mathMl:!0},FORCE_BODY:!0,CUSTOM_ELEMENT_HANDLING:{tagNameCheck:/^(marimo-[A-Za-z][\w-]*|iconify-icon)$/,attributeNameCheck:/^[A-Za-z][\w-]*$/}})}var O=p(y(),1),I=e=>{if(e instanceof u.Element&&!/^[A-Za-z][\w-]*$/.test(e.name))return m.createElement(m.Fragment)},D=(e,t)=>{if(t instanceof u.Element&&t.name==="body"){if((0,m.isValidElement)(e)&&"props"in e){let r=e.props.children;return(0,s.jsx)(s.Fragment,{children:r})}return}},V=(e,t)=>{if(t instanceof u.Element&&t.name==="html"){if((0,m.isValidElement)(e)&&"props"in e){let r=e.props.children;return(0,s.jsx)(s.Fragment,{children:r})}return}},W=e=>{if(e instanceof u.Element&&e.attribs&&e.name==="iframe"){let t=document.createElement("iframe");return Object.entries(e.attribs).forEach(([r,a])=>{r.startsWith('"')&&r.endsWith('"')&&(r=r.slice(1,-1)),t.setAttribute(r,a)}),(0,s.jsx)("div",{dangerouslySetInnerHTML:{__html:t.outerHTML}})}},$=e=>{if(e instanceof u.Element&&e.name==="script"){let t=e.attribs.src;if(!t)return;if(!document.querySelector(`script[src="${t}"]`)){let r=document.createElement("script");r.src=t,document.head.append(r)}return(0,s.jsx)(s.Fragment,{})}},P=(e,t)=>{if(t instanceof u.Element&&t.name==="a"){let r=t.attribs.href;if(r!=null&&r.startsWith("#")&&!r.startsWith("#code/")){let a=null;return(0,m.isValidElement)(e)&&"props"in e&&(a=e.props.children),(0,s.jsx)(M,{href:r,...t.attribs,children:a})}}},U=(e,t,r)=>{var a,i;if(t instanceof u.Element&&t.name==="div"&&((i=(a=t.attribs)==null?void 0:a.class)!=null&&i.includes("codehilite")))return(0,s.jsx)(Z,{children:e},r)},Z=e=>{let t=(0,O.c)(3),{children:r}=e,a=(0,m.useRef)(null),i;t[0]===Symbol.for("react.memo_cache_sentinel")?(i=(0,s.jsx)("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,s.jsx)(k,{tooltip:!1,className:"p-1",value:()=>{var n;let l=(n=a.current)==null?void 0:n.firstChild;return l&&l.textContent||""}})}),t[0]=i):i=t[0];let o;return t[1]===r?o=t[2]:(o=(0,s.jsxs)("div",{className:"relative group codehilite-wrapper",ref:a,children:[r,i]}),t[1]=r,t[2]=o),o};const B=({html:e,additionalReplacements:t=[],alwaysSanitizeHtml:r=!0})=>(0,s.jsx)(q,{html:e,alwaysSanitizeHtml:r,additionalReplacements:t});var q=({html:e,additionalReplacements:t=[],alwaysSanitizeHtml:r})=>{let a=F();return G({html:(0,m.useMemo)(()=>r||a?L(e):e,[e,r,a]),additionalReplacements:t})};function G({html:e,additionalReplacements:t=[]}){let r=[I,W,$,...t],a=[U,P,D,V];return w(e,{replace:(i,o)=>{for(let l of r){let n=l(i,o);if(n)return n}return i},transform:(i,o,l)=>{for(let n of a){let c=n(i,o,l);if(c)return c}return i}})}export{B as t};
